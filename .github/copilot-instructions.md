# Copilot Instructions for cladesync

## Summary
- Single-page frontend app: a music-social platform demo built with Vite + React 18 + TypeScript, Tailwind CSS, and shadcn/ui components.
- Includes a dev-only in-memory mock backend that intercepts `fetch` for `/api/demo/*` and serves data from `scripts/seeds.json`.

## High-Level Repo Facts
- Type: Vite SPA (no backend services in this repo).
- Languages: TypeScript, TSX, CSS, JSON; build tooling in JS/TS.
- Runtime/tooling: Node.js 18 (CI), npm (CI uses `npm ci`).
- Size (excluding `node_modules/`, `dist/`, `.git/`): ~99 files.
- Vite alias: `@` → `src` (see `vite.config.ts`).
- Note: `bun.lockb` exists but CI and scripts use npm; prefer npm for parity.

## Build/Run/Lint/Test (Validated)
All commands were run on Feb 20, 2026 from repo root on Windows PowerShell.

### Bootstrap
1. `npm ci`
- Required for clean installs; matches CI.
- Time: ~47s on this machine.
- Output included npm audit warnings (19 vulnerabilities). No action required for build/test.

### Dev Server
1. `npm run dev`
- Vite dev server.
- Actual port is **8080** (from `vite.config.ts`), not 5173 as README states.
- Host is `::` (IPv6 any). Use `http://localhost:8080/`.

### Build
1. `npm run build`
- Succeeds in ~4s.
- Non-fatal warning from Vite about `fs` being externalized due to `src/lib/mockServer.ts` import; build still completes.

### Lint
1. `npm run lint`
- Succeeds when run alone.
- **Do not run `lint` and `build` in parallel**: when run concurrently, `eslint` errored trying to open a transient `vite.config.ts.timestamp-*.mjs` file.

### Tests
- No test runner configured. CI does not run tests.

### Seed (Mock Data)
1. `node scripts/seed.js --count=10`
- Succeeds and rewrites `scripts/seeds.json` + `scripts/seeds_sample_preview.json`.
- CI uses this as a smoke test.

### Format
1. `npm run format`
- Runs `npx prettier --write .` (downloads prettier if not already installed).

### Cleaning
- Attempted `Remove-Item -Recurse -Force dist` to clean build output, but destructive commands are blocked by policy in this environment.
- If you need a clean build locally, remove `dist/` manually, then run `npm run build`.

## CI / Validation Pipelines
`/.github/workflows/ci.yml` runs on every push/PR:
1. Setup: `npm ci` (Node 18)
2. Lint: `npm run lint`
3. Build: `npm run build`
4. Seed smoke test: `node scripts/seed.js --count=10`
5. Deploy (main branch only): `npm run build` + publish `dist/` via `peaceiris/actions-gh-pages`

Replicate CI locally in this order:
1. `npm ci`
2. `npm run lint`
3. `npm run build`
4. `node scripts/seed.js --count=10`

## Project Layout and Architecture
### Core entry points
- `index.html`: Vite HTML entry.
- `src/main.tsx`: bootstraps app and conditionally initializes mock server.
- `src/App.tsx`: router + providers + dev-only nav.

### Mock API (dev only)
- `src/lib/mockServer.ts`: patches `globalThis.fetch` for `/api/demo/*` endpoints.
- Mock data source: `scripts/seeds.json` (generated by `scripts/seed.js`).
- Enabled when `import.meta.env.DEV` or `VITE_USE_MOCK=true`.

### Routing
- React Router v6 routes in `src/App.tsx`.
- Pages in `src/pages/*` (Index, Discover, Profile, Messages, Settings, DemoFeed, InvestorDashboard, NotFound).

### UI and styling
- Tailwind setup: `tailwind.config.ts`, `postcss.config.js`, `src/index.css`.
- shadcn/ui component library: `src/components/ui/*`.
- Shared components: `src/components/*`.

### Config & tooling
- Vite: `vite.config.ts` (port 8080, alias `@`).
- TypeScript: `tsconfig*.json` (non-strict for app code).
- ESLint: `eslint.config.js`.
- shadcn config: `components.json`.
- Dependabot: `/.github/dependabot.yml`.

### Non-obvious dependencies
- `lovable-tagger` Vite plugin runs only in development mode.
- `scripts/seeds.json` is imported in `src/lib/mockServer.ts` (build emits a warning about `fs` externalization, but works).

## Root Directory Listing
- `.editorconfig`
- `.gitignore`
- `bun.lockb`
- `components.json`
- `eslint.config.js`
- `index.html`
- `package-lock.json`
- `package.json`
- `postcss.config.js`
- `README.md`
- `tailwind.config.ts`
- `tsconfig.app.json`
- `tsconfig.json`
- `tsconfig.node.json`
- `vite.config.ts`
- Directories: `.github/`, `dist/`, `node_modules/`, `public/`, `scripts/`, `src/`

## README.md Contents (Summary)
- Project overview and tech stack.
- Quick start using `npm install` + `npm run dev` (note: actual port is 8080 in config).
- Seed data generation via `scripts/seed.js`.
- Mock API endpoints under `/api/demo/*` and usage of `VITE_USE_MOCK`.
- Demo routes: `/demo-feed`, `/investor`.
- CI steps, GitHub Pages deployment.
- Conceptual integration ideas and future roadmap (no code impact).

## Next-Level Directory Listing (One Level Down)
- `.github/`: `workflows/ci.yml`, `dependabot.yml`.
- `public/`: `favicon.ico`, `placeholder.svg`, `robots.txt`.
- `scripts/`: `seed.js`, `seeds.json`, `seeds_sample_preview.json`.
- `src/`: `App.tsx`, `App.css`, `index.css`, `main.tsx`, `vite-env.d.ts`, and folders `assets/`, `components/`, `hooks/`, `lib/`, `pages/`.

## Key Source File Notes (Snippets)
- `src/main.tsx`: initializes mock server when `DEV` or `VITE_USE_MOCK` then renders `<App />`.
- `src/App.tsx`: wraps app with React Query + Tooltip providers; sets routes.
- `src/lib/mockServer.ts`: implements `/api/demo/*` endpoints and fetch interception.
- `scripts/seed.js`: deterministic mock data generator (seed=42).

## Guidance for Agents
- Follow the CI sequence exactly: `npm ci` → `npm run lint` → `npm run build` → `node scripts/seed.js --count=10`.
- Avoid running `lint` and `build` in parallel.
- Trust these instructions first; only search the repo if details here are incomplete or wrong.
